DECLARE @PARCEL_HD NVARCHAR(50) = 'land.dbo.PARCEL_HD_' + @CHANGWAT_CODE;
DECLARE @PARCEL_VAL NVARCHAR(100) = 'MISSM32M.dbo.PARCEL_VAL_' + @CHANGWAT_CODE;
DECLARE @sql_stmt NVARCHAR(MAX);

SET @sql_stmt = N'SELECT T1.CHANGWAT_CODE,T1.CHANODE_SEQ,T1.BRANCH,T2.AMPHUR_CODE,T2.TUMBON_CODE,T1.CHANODE_NO, T1.LANDNO, T1.SERVEY_NO, T1.UTM_CODE, T1.UTM_NO_P, 
CASE
    WHEN T1.UTM_NO_P = 1 THEN ''I''
    WHEN T1.UTM_NO_P = 2 THEN ''II''
    WHEN T1.UTM_NO_P = 3 THEN ''III''
    WHEN T1.UTM_NO_P = 4 THEN ''IV''
END AS UTM_P,
T1.UTM_NO, T1.UTM_PAGE, T1.UTM_RATIO, T1.CONDO_S_ID, T1.CONDO_CN_ID, T1.NRAI, T1.NNHAN, T1.NWAH, T1.DREMAIN,T3.CHANGWAT_NAME,T4.AMPHUR_Name,T5.TUMBON_Name AS TUMBON_DESCRIPTION, T1.VAL_PER_WAH
,(T1.VAL_PER_WAH * ((T2.NRAI * 400) + (T2.NNHAN * 100) + (T2.NWAH + CAST(T2.DREMAIN as float)))) AS VAL_AMT
FROM condo.dbo.NCONDO_CHANODE T1 WITH (NOLOCK)
LEFT OUTER JOIN '+@PARCEL_HD+' T2 
ON T1.UTM_CODE = T2.UTM_CODE 
AND T1.UTM_NO_P = T2.UTM_NO_P 
AND T1.UTM_NO = T2.UTM_NO
AND RIGHT(''00'' + T1.UTM_PAGE , 2 ) = RIGHT(''00'' + T2.UTM_PAGE , 2 )
AND T1.UTM_RATIO = T2.UTM_RATIO
AND T1.LANDNO = T2.UTM_LANDNO
AND T1.CHANODE_NO = T2.CHANODE_NO
AND T1.CN_BRANCH = T2.BRANCH_CODE
AND T1.CN_AMPHUR_CODE = T2.AMPHUR_CODE
LEFT OUTER JOIN common.dbo.CHANGWAT_BRANCH T3 WITH (NOLOCK)
ON T1.BRANCH = T3.BRANCH
AND T2.CHANGWAT_CODE = T3.CHANGWAT_CODE
LEFT OUTER JOIN common.dbo.AMPHUR T4 WITH (NOLOCK)
ON T2.CHANGWAT_CODE = T4.PROVINCE_CODE
AND T2.AMPHUR_CODE = T4.AMPHUR_CODE
LEFT OUTER JOIN common.dbo.TUMBON T5 WITH (NOLOCK)
ON T2.CHANGWAT_CODE = T5.PROVINCE_CODE
AND T2.AMPHUR_CODE = T5.AMPHUR_CODE
AND T2.TUMBON_CODE = T5.TUMBON_CODE
LEFT OUTER JOIN 
 (
  SELECT * FROM '+@PARCEL_VAL+'
  WHERE REMARK_PUBLIC_DATE =''2559-2562''
 ) T6 
 ON T1.BRANCH = T6.BRANCH_CODE
 AND T1.UTM_NO = T6.UTM_NO 
 AND T1.UTM_PAGE = T6.UTM_PAGE
 AND T1.UTM_RATIO = T6.UTM_RATIO
 AND T1.LANDNO = T6.UTM_LANDNO
WHERE CONDO_S_ID =  '+@CONDO_S_ID+'
ORDER BY T1.CHANODE_NO, T1.UTM_NO , T1.UTM_PAGE
'
EXEC sp_executesql @sql_stmt;
