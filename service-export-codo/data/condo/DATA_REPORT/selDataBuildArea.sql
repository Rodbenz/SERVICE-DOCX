SELECT T1.BUILD_NO, T1.BUILDING_TYPE_ID, T5.BUILDING_TYPE_NAME, BUILD_AREA, SUM(T4.PERSONAL_P_AREA) ROOM_AREA, SUM(T6.PERSONAL_P_AREA) ROOM_AREA_NOTCAR
FROM(
SELECT CONDO_S_ID, CONDO_B_ID, BUILD_NO, BUILDING_TYPE_ID, BUILD_AREA
FROM condo.dbo.NCONDO_BUILD
WHERE CONDO_S_ID = @CONDO_S_ID AND TOWER_STAMP IS NULL) T1
LEFT OUTER JOIN
(
SELECT CONDO_S_ID, CONDO_B_ID, CONDO_L_ID, OFLEVEL
FROM condo.dbo.NCONDO_LEVEL
) T2
ON T1.CONDO_S_ID = T2.CONDO_S_ID
AND T1.CONDO_B_ID = T2.CONDO_B_ID
LEFT OUTER JOIN
(
SELECT CONDO_S_ID, CONDO_L_ID, CONDO_H_ID
FROM condo.dbo.NCONDO_HEADER
) T3
ON T1.CONDO_S_ID = T3.CONDO_S_ID
AND T2.CONDO_L_ID = T3.CONDO_L_ID
LEFT OUTER JOIN
(
SELECT PERSONAL_P_ID, CONDO_S_ID, CONDO_B_ID, CONDO_L_ID, CONDO_H_ID, PERSONAL_P_AREA
FROM condo.dbo.PERSONAL_PROPERTY
) T4
ON T1.CONDO_S_ID = T4.CONDO_S_ID
AND T1.CONDO_B_ID = T4.CONDO_B_ID
AND T2.CONDO_L_ID = T4.CONDO_L_ID
AND T3.CONDO_H_ID = T4.CONDO_H_ID
LEFT OUTER JOIN
(
SELECT BUILDING_TYPE_ID, BUILDING_TYPE_NAME
FROM condo.dbo.BUILDING_TYPE
) T5
ON T1.BUILDING_TYPE_ID = T5.BUILDING_TYPE_ID
LEFT OUTER JOIN
(
SELECT PERSONAL_P_ID, CONDO_S_ID, CONDO_B_ID, CONDO_L_ID, CONDO_H_ID, PERSONAL_P_AREA, PERSONAL_P_NAME
FROM condo.dbo.PERSONAL_PROPERTY
WHERE PERSONAL_P_NAME NOT LIKE '%ที่จอดรถยนต์%'
) T6
ON T4.PERSONAL_P_ID = T6.PERSONAL_P_ID
GROUP BY T1.BUILD_NO, T1.BUILDING_TYPE_ID, BUILD_AREA, T5.BUILDING_TYPE_NAME