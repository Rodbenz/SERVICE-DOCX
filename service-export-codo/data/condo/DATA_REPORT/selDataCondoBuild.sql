SELECT [BUILD_NO], [BUILDING_TYPE_ID], [BUILDING_TYPE_NAME], ROOM_AREA, SUM_BUILD, CONDO_B_ID, MAX_FLOOR, 0 AS NUM_TOWER, NULL AS BUILD_NO_TOWER, NULL AS PRONOUN_BUILD
FROM
(
  SELECT T2.ROOM_AREA
  	  ,T2.[BUILD_NO]    
        ,T2.CONDO_B_ID  
        ,T2.[BUILDING_TYPE_ID]
  	  ,T2.SUM_BUILD
  	  ,T3.[BUILDING_TYPE_NAME]
        ,T2.BLD_FL_TOT AS MAX_FLOOR
  FROM [condo].[dbo].[NCONDOS] T1
  LEFT JOIN
  (
  SELECT [CONDO_S_ID],[CONDO_B_ID],[BUILD_NO],[BUILDING_TYPE_ID],[ROOM_AREA], TOWER_STAMP, BLD_FL_TOT, COUNT(BUILDING_TYPE_ID) SUM_BUILD 
  FROM [condo].[dbo].[NCONDO_BUILD] 
  GROUP BY [CONDO_S_ID],[CONDO_B_ID],[BUILD_NO],[BUILDING_TYPE_ID],[ROOM_AREA], TOWER_STAMP, BLD_FL_TOT
  ) T2
  ON T1.[CONDO_S_ID] = T2.[CONDO_S_ID]
  LEFT JOIN
  [condo].[dbo].[BUILDING_TYPE] T3
  ON T2.BUILDING_TYPE_ID = T3.BUILDING_TYPE_ID
  where T1.[CONDO_S_ID] = @CONDO_S_ID AND T2.TOWER_STAMP IS NULL
) TT
GROUP BY [BUILD_NO],BUILDING_TYPE_ID,[BUILDING_TYPE_NAME],SUM_BUILD,ROOM_AREA, CONDO_B_ID, MAX_FLOOR
UNION
SELECT T1.BUILD_NO, T1.BUILDING_TYPE_ID, T4.BUILDING_TYPE_NAME, T1.ROOM_AREA, 1 AS SUM_BUILD, T1.CONDO_B_ID, MAX(T3.BLD_FL_TOT) AS MAX_FLOOR, COUNT(T2.T_CONDO_B_ID) AS NUM_TOWER
, (SELECT STUFF((SELECT ', ' + TU2.BUILD_NO
              FROM condo.dbo.NCONDO_BUILD_TOWER TU1
              LEFT OUTER JOIN condo.dbo.NCONDO_BUILD TU2
              ON TU1.CONDO_S_ID = TU2.CONDO_S_ID
              AND TU1.T_CONDO_B_ID = TU2.CONDO_B_ID
              WHERE TU1.B_CONDO_B_ID = T2.B_CONDO_B_ID
              ORDER BY TU2.CONDO_B_ORDER ASC
              FOR XML PATH('')), 1, 1, '') 
  BUILD_NO_TOWER) BUILD_NO_TOWER
, T2.PRONOUN_BUILD
FROM (
SELECT BUILD_NO, BUILD_AREA, ROOM_AREA, BLD_FL_TOT, CONDO_S_ID, CONDO_B_ID, CONDO_B_ORDER, TOWER_STAMP, BUILD_GROUP, BUILDING_TYPE_ID 
FROM condo.dbo.NCONDO_BUILD
WHERE CONDO_S_ID = @CONDO_S_ID AND TOWER_STAMP = 1
) T1
LEFT OUTER JOIN
(
SELECT CONDO_TB_ID, CONDO_S_ID, B_CONDO_B_ID, T_CONDO_B_ID, PRONOUN_BUILD
FROM condo.dbo.NCONDO_BUILD_TOWER
) T2
ON T1.CONDO_B_ID = T2.B_CONDO_B_ID
LEFT OUTER JOIN
(
SELECT BUILD_NO, BUILD_AREA, ROOM_AREA, BLD_FL_TOT, CONDO_S_ID, CONDO_B_ID, CONDO_B_ORDER, TOWER_STAMP, BUILD_GROUP, BUILDING_TYPE_ID 
FROM condo.dbo.NCONDO_BUILD
WHERE CONDO_S_ID = @CONDO_S_ID
) T3
ON T2.T_CONDO_B_ID = T3.CONDO_B_ID
LEFT OUTER JOIN [condo].[dbo].[BUILDING_TYPE] T4
ON T1.BUILDING_TYPE_ID = T4.BUILDING_TYPE_ID
GROUP BY T1.BUILD_NO, T1.BUILD_AREA, T1.ROOM_AREA, T1.CONDO_B_ID, T1.CONDO_S_ID, T1.CONDO_B_ORDER, T1.BUILDING_TYPE_ID, T2.B_CONDO_B_ID, T2.PRONOUN_BUILD, T4.BUILDING_TYPE_NAME
ORDER BY BUILDING_TYPE_ID,[BUILD_NO],[BUILDING_TYPE_NAME]